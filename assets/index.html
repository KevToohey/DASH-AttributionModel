<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html"><head>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <script src="js/aws-cognito-sdk.min.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>

    <script>
        var idToken = null;

        function checkLogin() {
            var url_string = window.location.href;
            var url = new URL(url_string);
            idToken = url.searchParams.get("id_token");
            if (idToken != null) {
                document.getElementById("welcomeMsg").innerHTML = "signed in";
                auth();
            }
        }

        function auth() {
            AWS.config.update({
                region: "ap-southeast-2",
            });

            AWS.config.credentials = new AWS.CognitoIdentityCredentials({
                IdentityPoolId : 'ap-southeast-2:56bb81e8-d2da-4494-8a5a-cd4f2bb8f3a0',        \\Idendity pool ID
                Logins : {
                    "cognito-idp.ap-southeast-2.amazonaws.com/ap-southeast-2_cRCR8Vv4o": idToken   \\User pool ID
                }
            });
        }

        function insertItem() {
            var docClient = new AWS.DynamoDB.DocumentClient();

            var params = {
                TableName :"Person",
                Item:{
                    "FirstName": "John", // Partition Key
                    "LastName": "Smith", // Sort Key
                    "info": {
                        "FavoriteColor": "blue",
                        "YearOfBirth": 1942
                    }
                }
            };
            docClient.put(params, function(err, data) {
                if (err) {
                    document.getElementById('textarea').innerHTML = "Unable to add item: " + "\n" + JSON.stringify(err, undefined, 2);
                } else {
                    document.getElementById('textarea').innerHTML = "PutItem succeeded: " + "\n" + JSON.stringify(data, undefined, 2);
                }
            });
        }

        function readItem() {

            var docClient = new AWS.DynamoDB.DocumentClient();

            var params = {
                TableName: "Person",
                Key:{
                    "FirstName": "John",// Partition Key
                    "LastName": "Smith" // Sort/Range Key
                }
            };
            docClient.get(params, function(err, data) {
                if (err) {
                    document.getElementById('textarea').innerHTML = "Unable to read item: " + "\n" + JSON.stringify(err, undefined, 2);
                } else {
                    document.getElementById('textarea').innerHTML = "GetItem succeeded: " + "\n" + JSON.stringify(data, undefined, 2);
                }
            });
        }

    </script>

    <link href="./css/main.css" rel="stylesheet" />
    <title>Document</title>
</head>

<body onload="checklogin()">
<div class="v3_9"><div class="v3_10"></div>
    <div class="v3_13"></div></div>

<p>Hello World 101!</p>

<p>111</p>

<div id="Welcome To The Atchison Tools Server Side - Check if you have authority to access Database Table Read/Write"></div> <br>
<a href="https://atchison-analytics.auth.ap-southeast-2.amazoncognito.com/login?client_id=3g32ac50kfu99jefakggke7lgr&response_type=token&scope=aws.cognito.signin.user.admin+email+openid+profile&redirect_uri=https://atchison.d23dx3aay083og.amplifyapp.com/">Login</a>

<br><br>

<input type="button" value="Insert Item To Secure Database" onclick="insertItem()" />
<input type="button" value="Read Item From Secure Database" onclick="readItem()" />

<textarea readonly id="textarea" style="width:400px; height:600px"></textarea>

</body></html>